function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},localHBUtils={isOnline:!0,getUrlParam:function(t){var e=decodeURIComponent(window.location.href);t=t.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)"),r=n.exec(e);return r&&r[2]?r[2].replace(/\+/g," "):null},identifyApp:function(){return new Promise(function(t){t(!1)})}},hbUtils=window.HBUtils||localHBUtils,showEventName="share_relational_chain_show",baseRequestParmArr=["mock","env"],contentParmArr=["share_id","share_user_uuid","share_time","dispatch_destination"],waitEventArr=[],localCacheUrlInfo={},hbUserInfo={},storageKey="_dimensity_cache_token",isInMyApp=!1,isLoadingConfig=!0,isFunction=function(t){if(!t)return!1;var e=Object.prototype.toString.call(t);return"[object Function]"==e||"[object AsyncFunction]"==e},getNow=function(){return Date.now&&isFunction(Date.now)?Date.now():(new Date).getTime()},getUrlPath=function(){var t=location.href,e=t.indexOf("?");return e!==-1&&(t=t.slice(0,e)),""+t},getSimpleUrlPath=function(){var t=location.href,e=t.indexOf("#");return e!==-1&&(t=t.slice(0,e)),""+t},getUUID=function(){var t=function(){for(var t=1*new Date,e=0;t==1*new Date;)e++;return t.toString(16)+e.toString(16)},e=function(){return getRandomString(16)},n=function(){function t(t,e){var n=void 0,r=0;for(n=0;n<e.length;n++)r|=o[n]<<8*n;return t^r}var e=navigator.userAgent,n=void 0,r=void 0,o=[],i=0;for(n=0;n<e.length;n++)r=e.charCodeAt(n),o.unshift(255&r),o.length>=4&&(i=t(i,o),o=[]);return o.length>0&&(i=t(i,o)),i.toString(16)};return function(r){var o=String(screen.height*screen.width);o=o&&/\d{5,}/.test(o)?o.toString(16):getRandomString(16);var i=void 0;return"token"===r?i=t()+"-"+e()+"-"+n()+"-"+o:"uuid"===r&&(i=t()+"-"+e()+"-"+n()),i?i:getRandomString()}}(),initAppUserInfo=function(){var t=function(){return new Promise(function(t){hbUtils.callHandler("getUserInfo","",function(e){e?t(e):(hbUtils.callHandler("reportWebError",{title:"JSBridge_issues",info:"getUserInfo 返回异常",res:"getUserInfo 返回异常"}),t(""))})})},e=function(){return new Promise(function(e){t().then(function(t){e(t?hbUtils.userInfoToObject(t):"")})["catch"](function(){e("")})})},n=function(){return new Promise(function(t){hbUtils.callHandler("getUuid","",function(e){t(e)})})},r=function(){var t=void 0,e=function(){var t=navigator.userAgent,e=/android|adr/gi.test(t),n=/iphone|ipod|ipad/gi.test(t)&&!e;return e?"android":n?"ios":"web"};try{t=JSON.parse(localStorage.getItem(storageKey))}catch(n){t=!1}var r={platform:e(),app_clone:hbUtils.getUrlParam("app_clone"),appcode:hbUtils.getUrlParam("appcode")};t&&isObject(t)?Object.assign(r,t):(r.token=getUUID("token"),r.uuid=getUUID("uuid"),localStorage.setItem(storageKey,JSON.stringify(r))),Object.assign(hbUserInfo,r)};return new Promise(function(t){hbUtils.identifyApp().then(function(o){return(isInMyApp=o)?void n().then(function(t){return t&&(hbUserInfo.uuid=t),e()}).then(function(e){isObject(e)&&Object.assign(hbUserInfo,e),t(!0)})["catch"](function(e){console.log(e),t(!0)}):(r(),void t(!1))})})},initLocalCacheUrlInfo=function(){baseRequestParmArr.forEach(function(t){localCacheUrlInfo[t]=hbUtils.getUrlParam(t)}),contentParmArr.forEach(function(t){localCacheUrlInfo[t]=hbUtils.getUrlParam(t)})},getRandomString=function(t){for(var e=t||32,n="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",r=n.length,o="",i=0;i<e;i++)o+=n.charAt(Math.floor(Math.random()*r));return o},getHostApi=function(){var t="";return t=hbUtils.isOnline?"https://bt.jiaoliuqu.com":"https://test-bt.taqu.cn"},getBaseRequestData=function(){var t={};return baseRequestParmArr.forEach(function(e){var n=hbUtils.getUrlParam(e);n&&(t[e]=n)}),t},getContentParams=function(t){var e={ua:getUA(),is_app_inside:isInMyApp,page_url:getUrlPath(),project_links:getSimpleUrlPath(),activity_title:document&&document.title||""};return contentParmArr.forEach(function(t){e[t]=localCacheUrlInfo[t]||""}),isObject(t)&&Object.assign(e,t),e},getBasicHeaderParams=function(){return{"content-type":"application/json; charset=UTF-8",accept:"application/json,text/plain,*/*",TO:hbUserInfo.token||"",AV:hbUserInfo.v||"",AP:hbUserInfo.appcode||"",CL:hbUserInfo.app_clone||"",PL:hbUserInfo.platform||"",AC:navigator.connection&&navigator.connection.effectiveType||"",x_forwarded_for:"",LA:"",LO:"",CH:"",SX:"",CI:"",ABGI:"",ABBI:"",ABEP:""}},getDataParms=function(t,e){var n={uuid:hbUserInfo.uuid||"",request_local_time:getNow(),brand:"",model:"",debug:"",abmark:"",udid:"",dev_id:"",ot:"",platform_ver:"",events:[]};return t&&"string"==typeof t&&(n.events[0]={track_id:getRandomString(),event_ts:getNow(),event_id:t,session_id:"",is_front:"",seq:"",content:Object.assign({},getContentParams(e))}),n},getUA=function(){var t={},e=navigator.userAgent.toLowerCase(),n=void 0;return(n=e.match(/ qq\/([\d.]+)/))?t.qqBuildinBrowser=Number(n[1].split(".")[0]):(n=e.match(/mqqbrowser\/([\d.]+)/))?t.qqBrowser=Number(n[1].split(".")[0]):(n=e.match(/opera.([\d.]+)/))?t.opera=Number(n[1].split(".")[0]):(n=e.match(/msie ([\d.]+)/))?t.ie=Number(n[1].split(".")[0]):(n=e.match(/edge.([\d.]+)/))?t.edge=Number(n[1].split(".")[0]):(n=e.match(/firefox\/([\d.]+)/))?t.firefox=Number(n[1].split(".")[0]):(n=e.match(/chrome\/([\d.]+)/))?t.chrome=Number(n[1].split(".")[0]):(n=e.match(/version\/([\d.]+).*safari/))?t.safari=Number(n[1].match(/^\d*.\d*/)):(n=e.match(/trident\/([\d.]+)/))&&(t.ie=11),JSON.stringify(t)},xhr=function(){if("undefined"!=typeof window.XMLHttpRequest)return new XMLHttpRequest;if(window.ActiveXObject)try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(t){console.log(t)}}},ajax=function(){function t(t){if(!t)return"";try{return JSON.parse(t)}catch(e){return{}}}function e(){try{r&&"object"===("undefined"==typeof r?"undefined":_typeof(r))&&r.abort&&r.abort()}catch(t){console.log(t)}a&&(clearTimeout(a),a=null,n.error&&n.error(),r.onreadystatechange=null,r.onload=null,r.onerror=null)}var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n.timeout=n.timeout;var r=xhr(n.cors);if(!r)return!1;n.type||(n.type=n.data?"POST":"GET"),n=Object.assign({success:function(){},error:function(){}},n);var o=n.success,i=n.error,a=void 0;n.success=function(t){o&&o(t),a&&(clearTimeout(a),a=null)},n.error=function(t){i&&i(t),a&&(clearTimeout(a),a=null)},a=setTimeout(function(){e()},n.timeout),"undefined"!=typeof XDomainRequest&&r instanceof XDomainRequest&&(r.onload=function(){n.success&&n.success(t(r.responseText)),r.onreadystatechange=null,r.onload=null,r.onerror=null},r.onerror=function(){n.error&&n.error(t(r.responseText),r.status),r.onreadystatechange=null,r.onerror=null,r.onload=null}),r.onreadystatechange=function(){try{4==r.readyState&&(r.status>=200&&r.status<300||304==r.status?n.success(t(r.responseText)):n.error(t(r.responseText),r.status),r.onreadystatechange=null,r.onload=null)}catch(e){r.onreadystatechange=null,r.onload=null}};try{isObject(n.params)&&Object.keys(n.params).length&&(n.url&&n.url.indexOf("?")===-1&&(n.url+="?"),n.url+=getUrlString(n.params))}catch(c){console.log(c)}r.open(n.type,n.url,!0);try{if(isObject(n.headers))for(var s in n.headers)r.setRequestHeader&&r.setRequestHeader(s,n.headers[s])}catch(c){console.log(c)}r.send(n.data||null)},isObject=function(t){return null!=t&&"[object Object]"==Object.prototype.toString.call(t)},getUrlString=function(t){var e="";return isObject(t)?(Object.keys(t).map(function(n){e&&(e+="&");var r=t[n];(isObject(r)||Array.isArray(r))&&(r=JSON.stringify(t[n])),e+=n+"="+r}),e):""},dimensity=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=window,o=1e4,i=getHostApi()+"/api/v2/track",a=(getBaseRequestData(),{}),c=function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];"string"==typeof t&&"function"==typeof l[t]&&l[t].apply(l,n)},s=function(t,e){var n=getDataParms(t,e);ajax({type:"POST",url:i,headers:Object.assign({},a),params:{},data:JSON.stringify(n),timeout:o})},u=function(){function t(){_classCallCheck(this,t),initLocalCacheUrlInfo(),initAppUserInfo().then(function(){a=getBasicHeaderParams(),isLoadingConfig=!1,c.apply(void 0,e),Array.isArray(waitEventArr)&&waitEventArr.length&&(waitEventArr.forEach(function(t){isFunction(t)&&t()}),waitEventArr.length=0)})}return _createClass(t,[{key:"start",value:function(t,e){t&&"string"==typeof t&&t===showEventName&&s(t,e)}},{key:"reportTrackEvent",value:function(t,e){if(t&&"string"==typeof t)return isLoadingConfig?void waitEventArr.push(function(){return s(t,e)}):void s(t,e)}}]),t}(),l=new u;return r.dimensityTrack=c,l};!function(t,e){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"object"===("undefined"==typeof module?"undefined":_typeof(module))?module.exports=e("start",showEventName):e("start",showEventName)}(void 0,dimensity);